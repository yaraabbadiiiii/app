#!/usr/bin/env python3
from __future__ import annotations

import argparse, logging, time

from service.logging_setup import setup_logging
from connectivity.network import start_qr_online_task

def main() -> int:
    ap = argparse.ArgumentParser(description="Background QR watcher → connect/switch on WIFI QR.")
    ap.add_argument("--debounce", type=float, default=6.0)
    args = ap.parse_args()

    setup_logging(logging.INFO)
    print("qr watcher running… (Ctrl+C to stop)")
    t = start_qr_online_task(debounce_s=args.debounce)

    try:
        while True: time.sleep(1.0)
    except KeyboardInterrupt:
        stop = getattr(t, "stop_event", None)
        if stop: stop.set()
        print("\nstopped")
        return 0

if __name__ == "__main__":
    raise SystemExit(main())
